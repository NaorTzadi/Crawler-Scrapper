package org.example;
import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;
public class SeleniumScrapper extends WebScrapper {
    public static WebScrapperDataBase getAllScrapedInfo(String url){
        WebScrapperDataBase webScrapperData=new WebScrapperDataBase(url,getContentType(url),getImageUrls(url),getVideoUrls(url));

        System.out.println(webScrapperData);
        System.out.println();
        return webScrapperData;
    }
    public static int getKeyWordAmountOfOccurrences(String url) {
        Scanner scanner=new Scanner(System.in);
        System.out.println("choose a key word to search for:");
        String keyword=scanner.nextLine();
        if(keyword.equals("0")){return -1;}
        ChromeDriver chromeDriver = Utility.getModifiedChromeDriver();
        chromeDriver.get(url);
        String pageText = chromeDriver.findElement(By.tagName("body")).getText();
        chromeDriver.quit();
        if (pageText.contains(keyword)){
            int count=countOccurrences(pageText.toLowerCase(), keyword.toLowerCase());
            System.out.println("the key word "+keyword+" was found "+count+" times.");
            return count;
        }
        System.out.println("the key word "+keyword+" was not found!");
        return 0;
    }
    public static ArrayList<String> getImageUrls(String url) {
        ChromeDriver chromeDriver = Utility.getModifiedChromeDriver();
        chromeDriver.get(url);
        List<WebElement> imageElements = chromeDriver.findElements(By.tagName("img"));
        ArrayList<String> imageUrls = new ArrayList<>();
        for (WebElement imageElement : imageElements) {
            String imageSrc = imageElement.getAttribute("src");
            if (imageSrc != null && !imageSrc.isEmpty()) {
                imageUrls.add(imageSrc);
            }
        }
        chromeDriver.quit();
        return imageUrls;
    }
    public static ArrayList<String> getVideoUrls(String url){
        ChromeDriver chromeDriver= Utility.getModifiedChromeDriver();
        chromeDriver.get(url);
        List<WebElement> videoElements = chromeDriver.findElements(By.tagName("video"));
        ArrayList<String> videoUrls = new ArrayList<>();
        for (WebElement videoElement : videoElements) {
            String videoSrc = videoElement.getAttribute("src");
            if (videoSrc != null && !videoSrc.isEmpty()) {
                videoUrls.add(videoSrc);
            }
            List<WebElement> sourceElements = videoElement.findElements(By.tagName("source"));
            for (WebElement sourceElement : sourceElements) {
                String sourceSrc = sourceElement.getAttribute("src");
                if (sourceSrc != null && !sourceSrc.isEmpty()) {
                    videoUrls.add(sourceSrc);
                }
            }
        }
        chromeDriver.quit();
        return videoUrls;
    }

}
